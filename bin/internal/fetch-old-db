#!/usr/bin/env sh

DATE=`date +%Y-%m-%d`
HOST=deploy@blog.subvisual.co
FILE=/tmp/blog-$DATE.dump

echo "Dumping DB on remote server"

ssh -t $HOST -C "sudo -u postgres pg_dump -C blog.subvisual.co --format=c > $FILE"

echo "Transfering"
scp $HOST:$FILE $FILE > /dev/null

echo "Restoring local database"
sudo -u postgres pg_restore --clean -d blog $FILE > /dev/null 2> /dev/null
echo "Done"
